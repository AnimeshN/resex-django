{% extends "labs/base.html" %}
{% load static %}
{% block content %}
    <style>
        html,body {
            font-family: Arial, sans-serif;
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .mycontainer {
            display: flex;
            flex-wrap: wrap;
            height: 100%;
            margin: 5px;

            /* background-color: red; */
        }

        .left-panel {
            background-color: lightgray;
            display: none;
            padding: 10px;
            flex:3;
            justify-content: center;
            align-items: center;
            height: 100%;
            
        }

        .right-panel {
            /* background-color: violet; */
            padding: 10px;
            flex:9;
            height: 100%;

        }

        .card-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .card {
            flex-basis: calc(25% - 10px);
            border: 1px solid #ddd;
            /* padding: 10px; */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            text-align: center;
        }

        .card {
            width: 100%;
            height: auto;
        }

        input, select {
            width: 90%;
            margin-bottom: 10px;
            padding: 8px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .card {
                flex-basis: calc(50% - 10px);
            }
        }

        @media (max-width: 480px) {
            .card {
                flex-basis: 100%;
            }

            .left-panel, .right-panel {
                padding: 5px;
            }
        }

        #toggleButton {
            position: fixed; /* Fixed position relative to the viewport */
            right: 20px; /* 20px from the right edge */
            bottom: 20px; /* 20px from the bottom edge */
            background-color: #007bff; /* Blue background */
            color: white; /* White text */
            border: none; /* Remove default border */
            padding: 10px 20px; /* Top/bottom and left/right padding */
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer; /* Pointer cursor on hover */
            border-radius: 5px; /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0,0,0,0.3); /* Subtle shadow for depth */
            transition: background-color 0.3s ease; /* Smooth transition for hover effect */
            z-index: 1000; /* Ensure it stays on top of other elements */
        }

        #toggleButton:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }


    .card-info{
        display: flex;
        padding: 10px;
    }
    .card-left-info{
        flex:80;
    }
    .card-right-info{
        flex:20;
        margin-top:10px;
    }
    .card-lab-name{
        display: flex;
        gap:10px;
        font-size:14px;
    }
    .card-department-name{
        display: flex;
        gap:10px;
    }

    .card-button{
        background-color : #5D5AE9;
        color: white;
        border: none;
        padding: 5px 10px; 
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer; 
        border-radius: 5px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.3); 
        transition: background-color 0.3s ease;
    }
    .card-button:hover {
        background-color: #0056b3; /* Darker blue on hover */
    }


    .toast {
        visibility: hidden;
        min-width: 80%;
        min-height: 60%;
        /* margin-left: -125px; */
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 2px;
        padding: 16px;
        position: fixed;
        z-index: 1;
        left: 10%;
        bottom: 25%;
        font-size: 17px;
        margin-right: 50%;
    }

    /* Show the toast when adding the "show" class */
    .show {
        visibility: visible;
        -webkit-animation: fadein 0.5s;
        animation: fadein 0.5s;
    }

    @-webkit-keyframes fadein {
        from {bottom: 20%; opacity: 0;} 
        to {bottom: 25%; opacity: 1;}
    }

    @keyframes fadein {
        from {bottom: 20%; opacity: 0;}
        to {bottom: 25%; opacity: 1;}
    }

    @-webkit-keyframes fadeout {
        from {bottom: 30px; opacity: 1;} 
        to {bottom: 0; opacity: 0;}
    }

    @keyframes fadeout {
        from {bottom: 30px; opacity: 1;}
        to {bottom: 0; opacity: 0;}
    }

    .close {
        position: absolute;
        top: 0;
        right: 10px;
        color: #fff;
        font-size: 25px;
        cursor: pointer;
    }

    .close:hover {
        color: #bbb;
    }

    </style>
    <button id="toggleButton">Filter</button>

    <div class="mycontainer">
        <!-- Left Panel -->
        <div class="left-panel" id="leftPanel">
            <!-- <input type="text" placeholder="Search..."> -->

            <form class="d-flex" method=POST >
                {% csrf_token %}
                <input class="form-control me-2" type="search" placeholder="Search Labs" aria-label="Search" name="searched_labs">
                <button class="btn btn-outline-success" type="submit">Search</button>
              </form>

              
            <select>
                <option value="option1">Option 1</option>
                <option value="option2">Option 2</option>
                <!-- Add more options as needed -->
            </select>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Row of Cards -->
            <div class="card-row">
            {% for lab in labs %}
	        {% if lab.approved %}   
                <div class="card">
                    <img width="100%" height="auto" src="{% static 'images/dummy_image.jpeg' %}" alt="Image 1">
                    <div class="card-info">
                        <div class="card-left-info">
                            <div class="card-lab-name">
                                <div class="icon">
                                    <img width="15px" height="15px" src="{% static 'images/lab-icon.png' %}" alt="Image 1">
                                </div>
                                <div class="Name">{{ lab }}</div>
                            </div>
                            <div class="card-department-name">
                                <div class="icon">
                                    <img width="15px" height="15px" src="{% static 'images/dep-icon.png' %}" alt="Image 1">
                        
                                </div>
                                <div class="Name">{{ lab.academic_division }}</div>
                            </div>
                        </div>
                        <div  class="card-right-info">
                            <button onclick=openToaste({{lab.id}}) class="card-button">View</button>
                        </div>
                    </div>
                </div>
                {% endif %}	
                {% endfor %}
            </div>
            <!-- Additional rows can be added in the same format -->
        </div>
    </div>

    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
      
          {% if labs.has_previous %}
              <li class="page-item"><a class="page-link" href="?page=1">&laquo</a></li>
              <li class="page-item"><a class="page-link" href="?page={{ labs.previous_page_number }}"> Prev</a></li>
          {% elif not labs.has_previous %}
                   <li class="page-item disabled"><a class="page-link" href="#">&laquo</a></li>
                  <li class="page-item disabled"><a class="page-link" href="#">Prev</a></li>
          {% endif %}
      
          <!-- <li class="page-item disabled"><a class="page-link" href="#">Page {{ labs.number }} of {{ labs.paginator.num_pages }}</a></li> -->
      
      
          {% for i in nums %}
          <li class="page-item"><a class="page-link" href="?page={{ forloop.counter }}">{{ forloop.counter }}</a></li>
          {% endfor %}
      
      
          {% if labs.has_next %}	
          <li class="page-item"><a class="page-link" href="?page={{ labs.next_page_number }}">Next</a></li>
          <li class="page-item"><a class="page-link" href="?page={{ labs.paginator.num_pages }}">&raquo</a></li>
      
          {% elif not labs.has_next %}
                   <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                  <li class="page-item disabled"><a class="page-link" href="#">&raquo</a></li>
          
          {% endif %}
        </ul>
      </nav>

      <div id="toast" class="toast">
        <div id="toast-html">
            This is a toast message!
        </div>
        <span id="closeToast" class="close">&times;</span>
    </div>
     <script>
        document.getElementById('toggleButton').addEventListener('click', function() {
            var leftPanel = document.getElementById('leftPanel');
            leftPanel.style.display = leftPanel.style.display === 'block' ? 'none' : 'block';
        });


        document.getElementById('closeToast').onclick = function() {
            var toastElement = document.getElementById('toast');
            toastElement.classList.remove('show');
        };

        function getCSRFToken() {
            return $('[name=csrfmiddlewaretoken]').val();
        }

        function openToaste(id){
            const toastHTML = document.getElementById('toast-html');
            // const div = document.querySelector("toast");

            const lab_id = id;
            // fetch('/resxlabs/', {
            //     method: 'POST',
            //     body: {"lab_id":lab_id}
            // })
            // .then(response => console.log(response))
            // .then(data => {
            //     // toastElement.textContent = data.message;
            // })
            // .catch(error => console.error('Error:', error));


            $.ajax({
                    url: '/resxlabs/',
                type: 'POST',
                data: {
                    'lab_id': id,
                    'csrfmiddlewaretoken': getCSRFToken()
                },
                success: function(response) {
                    console.log(response);
                    toastHTML.innerHTML = response.message;

                },
                error: function(xhr, errmsg, err) {
                    console.log('Error:', errmsg);
                }
            });
            

            console.log(id);
            var toastElement = document.getElementById('toast');
            toastElement.classList.add('show');
            }

           

    </script>


{% endblock %}
